# -*- shell-script -*-

#
# helper functions to help migrations and upgrades
#
#
# Typical workflow:
#
# when upgrading from, say, fedora 27 to fedora29, here's how we tackle it:
#
# * we start with thurst = nbhosting.inria.fr


SERVICES="nbhosting-addr nbhosting-dev-addr nbh-uwsgi nbh-monitor docker"
CONFIG=$HOME/nbhosting/django/nbh_main/sitesettings.py

function upgrade-status() {
    for service in $SERVICES; do
        echo ===== $service =====
        systemctl is-active $service
        systemctl is-enabled $service
    done
    echo '===== configuration ====='
    egrep '^(server_name|ssl_certificate)' $CONFIG
    echo '===== data space ====='
    ls -ld /nbhosting/current/{students,raw}*
}

function upgrade-sizes() {
    for dataspace in /nbhosting/current/{students,raw}*; do
        echo "===== size of $dataspace ====="
        du -hs $dataspace
    done
}


########## btrfs

BTRFS=/nbhosting/dockers

alias b=btrfs
alias bv="btrfs subvolume"
alias bvd="btrfs subvolume delete"
alias bvl="btrfs subvolume list $BTRFS"
